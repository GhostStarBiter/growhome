#ifndef SCHEDULE_H_
#define SCHEDULE_H_

#include "stm32f10x.h"
#include "main/types.h"
#include "rtc/mcu_rtc.h"


//typedef enum{
//  SUNDAY,
//  MONDAY,
//  TUESDAY,
//  WEDNESDAY,
//  THURSDAY,
//  FRIDAY,
//  SATURDAY,
//  DAYS_IN_WEEK
//} weekday_t;


typedef struct{
    mcu_time_t  on_time;            // used for light/water schedule
    mcu_time_t  expected_endtime;   // used for light/water schedule control
    uint32_t    duration_sec;       // used for light/water schedule
    uint32_t    interval_minutes;   // used for water schedule
} activity_schedule_t;


//--------------------------------------------------------------------------------------------------
/// @brief  Init schedule module
//--------------------------------------------------------------------------------------------------
void schedule_init(void);


//--------------------------------------------------------------------------------------------------
/// @brief  Periodic check of schedule
/// @param
/// @param
//--------------------------------------------------------------------------------------------------
void schedule_update(
    FunctionalState *greenhouse_light_state,
    FunctionalState *greenhouse_water_pump_state
);


//--------------------------------------------------------------------------------------------------
/// @brief  API to set light day schedule from outside (e.g. ESP WI-FI)
/// @param
/// @param
//--------------------------------------------------------------------------------------------------
result_t schedule_set_light_schedule(
    activity_schedule_t new_light_schedule
);


//--------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------
void schedule_light_update_expected_endtime(void);


//--------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------
void schedule_set_light_t_on_hour
(
    uint8_t hour_turn_light_on
);


//--------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------
uint8_t schedule_get_light_t_on_hour(void);


//--------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------
void schedule_set_light_t_on_min
(
    uint8_t min_turn_light_on
);


//--------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------
uint8_t schedule_get_light_t_on_min(void);


//--------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------
uint8_t schedule_get_light_duration_hours(void);


//--------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------
void schedule_set_light_duration_hours
(
    uint8_t light_on_duration
);


//--------------------------------------------------------------------------------------------------
/// @brief  API to set water day schedule from outside (e.g. ESP WI-FI)
//--------------------------------------------------------------------------------------------------
result_t schedule_set_water_schedule(
    activity_schedule_t new_water_schedule
);


//--------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------
void schedule_set_water_duration_sec
(
    uint8_t water_duration_sec
);


//--------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------
uint32_t schedule_get_water_duration_sec(void);


//--------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------
void schedule_set_water_interval_mins
(
    uint8_t new_water_interval_mins
);


//--------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------
uint32_t schedule_get_water_interval_mins(void);

#endif // SCHEDULE_H_
